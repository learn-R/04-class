#Instalar paquetes
install.packages("pacman")
library(pacman)
pacman::p_load(dplyr,haven, summarytools, stargazer, equatiomatic,sjlabelled,car)

#Preparación de datos
#Abrir base de datos
setwd("G:/Sociología/Tercer año/Primer semestre/Trabajos/Entrega Final EM")
esi <- read_dta("esi_2018_personas.dta")

#Seleccionar variables
esi_proc <- esi %>%select (ing_t_p, b9, sexo, b1, b11, cine, region)
#Renombre de variables
esi_proc<- esi_proc %>% rename ("ingresos"=ing_t_p, 
                                "contrato"=b9, "sector"=b1,"pago"=b11)
#Etiquetado de variables 
esi_proc$ingresos <- set_label(x=esi_proc$ingresos,
                               label= "Ingresos del trabajo principal")
esi_proc$contrato  <- set_label(x = esi_proc$contrato, 
                                label = "Duracion de contrato")
esi_proc$sector  <- set_label(x = esi_proc$sector, 
                              label = "Grupo de ocupacion")

#Etiquetado de categorías
esi_proc$sexo <- factor(esi_proc$sexo, labels=c("Hombre", "Mujer"))
esi_proc$contrato <- factor(esi_proc$contrato,
                            labels=c("Definido",
                                     "Indefinido"))
esi_proc$region <- factor(esi_proc$region, 
                          labels=c("Region de Tarapaca",
                                   "Region de Antofagasta",
                                   "Region de Atacama",
                                   "Region de Coquimbo",
                                   "Region de Valparaiso",
                                   "Region de O'Higgins",
                                   "Region del Maule",
                                   "Region del Biobio",
                                   "Region de La Araucania",
                                   "Region de Los Lagos",
                                   "Region de Aysen",
                                   "Region de Magallanes",
                                   "Region Metropolitana",
                                   "Region de Los Rios", 
                                   "Region de Arica y Parinacota",
                                   "Region de Ñuble"))

esi_proc$sector <- factor(esi_proc$sector,
                          labels=c("Miembros del poder ejecutivo y de los
                                 cuerpos legislativos y personal directivo de
                                 la administracion publica y de empresas",
                                   "Profesionales cientificos e intelectuales",
                                   "Tecnicos y profesionales de nivel medio",
                                   "Empleados de oficina",
                                   "Trabajadores de los servicios y vendedores
                                 de comercios y mercados",
                                   "Agricultores y trabajadores calificados
                                 agropecuarios y pesqueros",
                                   "Oficiales, operarios y artesanos de artes
                                 mecanicas y de otros oficios",
                                   "Operadores de instalaciones y maquinas y
                                 montadores",
                                   "Trabajadores no calificados",
                                   "Otros no identificados"))
esi_proc$pago <- factor(esi_proc$pago,
                        labels=c ("Boleta a honorarios",
                                  "Liquidacion de sueldo",
                                  "Comprobante o recibo",
                                  "No recibe ni entrega comprobante",
                                  "Boleta o factura"))
esi_proc$cine <- car::recode(esi_proc$cine,"c(1,2,3)=1; 
                             c(4)=2;c(5)=3;c(6)=4;c(7)=5;c(8,9)=6")
esi_proc$cine <- recode(esi_proc$cine, "(999)=NA")
esi_proc$cine <- factor(esi_proc$cine,
                        labels= c("Primaria incompleta o menos",
                                  "Primaria y secundaria baja",
                                  "Secundaria alta",
                                  "Terciaria ciclo corto",
                                  "Terciaria",
                                  "Posgrados"))
#Tratamiento de NA
esi_procoriginal <- esi_proc 
dim(esi_proc) 
sum(is.na(esi_proc)) 
esi_proc <- na.omit(esi_proc) 
dim(esi_proc)
esi_proc <- sjlabelled::copy_labels(esi_proc,esi_procoriginal)

#Guardar
save(esi_proc, file="/Volumes/Nico Godoy/Sociología/Tercer año/Primer semestre/Trabajos/Estadística/Trabajo grupal/ESI.RData")

